<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-HXHT6KGZT3"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-HXHT6KGZT3', {
            debug_mode: true,
            send_page_view: true,
            allow_google_signals: true,
            enhanced_measurement: {
                scroll: true,
                engagement: true,
                page_changes: true,
                url_changes: true
            }
        });

        // Add right after your gtag config
        const startTime = performance.now();

        window.addEventListener('load', () => {
            const loadTime = performance.now() - startTime;
            gtag('event', 'page_load_time', {
                value: Math.round(loadTime),
                metric_id: 'load_time'
            });
        });
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modular Shelving - Framework Designs</title>
    <link rel="stylesheet" href="css/styles.css">

    <!-- Load React -->
    <script src="https://unpkg.com/react@16/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js"></script>
    <!-- Load Babel -->
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <!-- Load Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .gallery-item {
            transition: transform 0.2s;
        }

        .gallery-item:hover {
            transform: translateY(-4px);
        }

        .lightbox-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }

        .lightbox-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .lightbox-content {
            max-width: 90vw;
            max-height: 90vh;
            position: relative;
            transform: scale(0.95);
            transition: transform 0.3s;
        }

        .lightbox-overlay.active .lightbox-content {
            transform: scale(1);
        }

        .lightbox-image {
            max-width: 100%;
            max-height: 80vh;
            object-fit: contain;
        }

        .featured-section-card {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .featured-section-card img {
            flex: 1;
            object-fit: cover;
            min-height: 200px;
        }

        .section-card {
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .section-image {
            height: 300px;
            object-fit: cover;
        }
        
        @media (max-width: 768px) {
            .section-card {
                flex-direction: column;
            }
            .section-image {
                width: 100%;
                height: 200px;
            }
        }

        /* Simple, elegant heading style */
        .section-title {
            font-weight: 300;
            letter-spacing: 0.5px;
            position: relative;
            color: #333;
            border-bottom: 1px solid #eaeaea;
            padding-bottom: 8px;
            margin-bottom: 16px;
        }
        
        /* Elegant link style */
        .elegant-link {
            color: #4a6c8a;
            font-weight: 400;
            text-decoration: none;
            border-bottom: 1px solid #e0e0e0;
            transition: all 0.2s ease;
            padding-bottom: 2px;
        }
        
        .elegant-link:hover {
            color: #2c4b6e;
            border-bottom-color: #4a6c8a;
        }
    </style>
</head>

<body class="bg-white">
    <!-- Header bar -->
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;700&display=swap">
    <link rel="stylesheet" href="css/styles.css">
    <script src="js/site.js"></script>
    
    <div class="gallery-container" role="main">
        <p class="gallery-intro max-w-4xl mx-auto px-4 pt-8 pb-2 text-center">
            Kenya's first modular shelf system. Infinitely expandable with no tools necessary. Start small and add more
            shelves as you need them. Scroll down to learn more or <a href="simplified-designer.html" class="elegant-link">click here to start your order</a>.
        </p>
    </div>
    <div id="root"></div>

    <script type="text/babel">
        // Gallery images data
        const galleryImages = [
            {
                id: 'shelf-00',
                path: 'images/shelving/shelf (18).jpg',
                caption: '<strong>Infinitely Expandable</strong><br>Our modular system grows in any direction – stack it vertically, extend it horizontally, and turn corners. Create a storage solution perfectly suited to your space.'
            },
            {
                id: 'shelf-01',
                path: 'images/shelving/shelf (14).jpg',
                caption: '<strong>Made in Kenya</strong><br>The slim proportions of our shelves are made possible thanks to a mild steel frame, engineered wood surface, and exceptional craftsmanship. No pile of books will be too much for them to bear, so don&apos;t hesitate to load them up.'
            },
            {
                id: 'shelf-03',
                path: 'images/shelving/shelf (00).jpg',
                caption: '<strong>Ready to Accessorize</strong><br>Choose from our carefully curated palette of vibrant color options, and customize your shelf further with our add-on lamps and bookends.'
            },
            {
                id: 'shelf-04',
                path: 'images/shelving/shelf (04).jpg',
                caption: 'Combine several units to make a tall elegant shelf. The unit shown goes for Ksh 28,500.'
            },
            {
                id: 'shelf-10',
                path: 'images/shelving/shelf (10).jpg',
                caption: 'Adding on extra shelves is as easy as sliding them together. No tools necessary.'
            },
            {
                id: 'shelf-11',
                path: 'images/shelving/shelf (11).jpg',
                caption: 'Steel construction makes for a rock-solid structure'
            },
            {
                id: 'shelf-11b',
                path: 'images/shelving/shelf (11b).jpg',
                caption: 'Grow your shelves as you grow your library.'
            },
            {
                id: 'shelf-12',
                path: 'images/shelving/shelf (12).jpg',
                caption: 'All shelves come with adjustable feet to ensure stability on uneven floors.'
            },
            {
                id: 'shelf-14',
                path: 'images/shelving/shelf (14).jpg',
                caption: 'Top-knotch fabrication and perfectly engineered details.'
            },
            {
                id: 'shelf-17',
                path: 'images/shelving/shelf (17).jpg',
                caption: 'Designed to fit in any corner of your home or office.'
            },
            {
                id: 'shelf-20',
                path: 'images/shelving/shelf (20).jpg',
                caption: 'The system can expand to hold your entire collection.'
            },
            {
                id: 'shelf-video',
                path: 'images/shelving/designer-tutorial.gif',
                caption: 'Design a shelf that is perfect for your space with our online design tool.'
            }
        ];

        // Track scroll depth
        function trackScrollDepth() {
            let maxScroll = 0;
            let scrollTimeout;

            document.addEventListener('scroll', () => {
                if (scrollTimeout) {
                    clearTimeout(scrollTimeout);
                }

                scrollTimeout = setTimeout(() => {
                    const scrollPercent = Math.round(
                        (window.scrollY + window.innerHeight) /
                        document.documentElement.scrollHeight * 100
                    );

                    // Only track at significant thresholds
                    if (scrollPercent >= 90 && maxScroll < 90) {
                        maxScroll = 90;
                        gtag('event', 'scroll_depth', {
                            percent_scrolled: 90
                        });
                    }
                    else if (scrollPercent >= 75 && maxScroll < 75) {
                        maxScroll = 75;
                        gtag('event', 'scroll_depth', {
                            percent_scrolled: 75
                        });
                    }
                    else if (scrollPercent >= 50 && maxScroll < 50) {
                        maxScroll = 50;
                        gtag('event', 'scroll_depth', {
                            percent_scrolled: 50
                        });
                    }
                    else if (scrollPercent >= 25 && maxScroll < 25) {
                        maxScroll = 25;
                        gtag('event', 'scroll_depth', {
                            percent_scrolled: 25
                        });
                    }
                }, 100); // 100ms debounce
            });
        }

        // Featured Gallery Item Component
        function FeaturedGalleryItem({ image, index, onImageClick }) {
            return (
                <div className="gallery-item">
                    <div className="relative aspect-square cursor-pointer" onClick={() => onImageClick(index)}>
                        <img
                            src={image.path}
                            alt={image.caption.replace(/<\/?[^>]+(>|$)/g, "")}
                            loading={index > 0 ? "lazy" : "eager"}
                            className="w-full h-full object-cover rounded-lg shadow-md"
                        />
                    </div>
                    <p 
                        className="mt-3 text-gray-700" 
                        dangerouslySetInnerHTML={{ __html: image.caption }}
                    ></p>
                </div>
            );
        }

        // Lightbox Component
        function Lightbox({ isOpen, currentIndex, images, onClose, onNext, onPrev }) {
            const handleKeyDown = React.useCallback((e) => {
                if (e.key === 'Escape') onClose();
                if (e.key === 'ArrowRight') onNext();
                if (e.key === 'ArrowLeft') onPrev();
            }, [onClose, onNext, onPrev]);

            React.useEffect(() => {
                if (isOpen) {
                    document.addEventListener('keydown', handleKeyDown);
                    document.body.style.overflow = 'hidden';
                } else {
                    document.removeEventListener('keydown', handleKeyDown);
                    document.body.style.overflow = '';
                }
                
                return () => {
                    document.removeEventListener('keydown', handleKeyDown);
                    document.body.style.overflow = '';
                };
            }, [isOpen, handleKeyDown]);

            if (!isOpen) return null;

            const image = images[currentIndex];

            return (
                <div className={`lightbox-overlay ${isOpen ? 'active' : ''}`} onClick={onClose}>
                    <div className="lightbox-content" onClick={(e) => e.stopPropagation()}>
                        <div className="relative bg-white rounded-lg overflow-hidden">
                            <button 
                                onClick={onClose}
                                className="absolute top-2 right-2 z-10 bg-white rounded-full w-8 h-8 flex items-center justify-center text-xl font-bold shadow hover:bg-gray-100"
                                aria-label="Close lightbox"
                            >
                                ×
                            </button>

                            <div className="flex items-center justify-center bg-black p-2">
                                <img 
                                    src={image.path} 
                                    alt={image.caption.replace(/<\/?[^>]+(>|$)/g, "")} 
                                    className="lightbox-image"
                                />
                            </div>
                            
                            <div className="p-4">
                                <p className="text-gray-800" dangerouslySetInnerHTML={{ __html: image.caption }}></p>
                                
                                <div className="mt-4 flex justify-between items-center">
                                    <button 
                                        onClick={onPrev}
                                        className="bg-gray-200 hover:bg-gray-300 rounded-md px-4 py-2 transition-colors"
                                        aria-label="Previous image"
                                    >
                                        ← Previous
                                    </button>
                                    
                                    <span className="text-sm text-gray-500">
                                        {currentIndex + 1} / {images.length}
                                    </span>
                                    
                                    <button 
                                        onClick={onNext}
                                        className="bg-gray-200 hover:bg-gray-300 rounded-md px-4 py-2 transition-colors"
                                        aria-label="Next image"
                                    >
                                        Next →
                                    </button>
                                </div>
                                
                                <div className="mt-6 flex justify-center">
                                    <a 
                                        href="simplified-designer.html" 
                                        className="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-6 rounded-md transition-colors"
                                        onClick={() => {
                                            gtag('event', 'click', {
                                                event_category: 'navigation',
                                                event_label: 'lightbox_order_button'
                                            });
                                        }}
                                    >
                                        Order a Shelf
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // WhatsApp Button Component
        function WhatsAppButton() {
            return (
                <a
                    href="https://wa.me/254783891005"
                    target="_blank"
                    rel="noopener noreferrer"
                    className="fixed bottom-6 right-6 bg-green-600 text-white p-4 rounded-full shadow-lg hover:bg-green-700 transition-all duration-200 z-50 flex items-center gap-2 group md:pr-6"
                    onClick={() => {
                        gtag('event', 'click_chat', {
                            event_category: 'engagement',
                            event_label: 'whatsapp_chat'
                        });
                    }}
                >
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z" />
                    </svg>
                    <span className="hidden md:inline whitespace-nowrap">Chat on WhatsApp</span>
                </a>
            );
        }

        // Main App Component
        function App() {
            const [lightboxOpen, setLightboxOpen] = React.useState(false);
            const [currentImageIndex, setCurrentImageIndex] = React.useState(0);
            
            // Initialize scroll tracking
            React.useEffect(() => {
                trackScrollDepth();
                
                // Check for gallery parameter in URL
                const urlParams = new URLSearchParams(window.location.search);
                const galleryParam = urlParams.get('gallery');
                if (galleryParam === 'open') {
                    setLightboxOpen(true);
                    const imageIndex = parseInt(urlParams.get('image')) || 0;
                    setCurrentImageIndex(Math.min(Math.max(0, imageIndex), galleryImages.length - 1));
                }
            }, []);

            // Handle opening the lightbox
            const openLightbox = (index) => {
                setCurrentImageIndex(index);
                setLightboxOpen(true);
                
                // Update URL without refreshing page
                const url = new URL(window.location);
                url.searchParams.set('gallery', 'open');
                url.searchParams.set('image', index);
                window.history.pushState({}, '', url);
                
                gtag('event', 'open_gallery', {
                    event_category: 'engagement',
                    image_index: index
                });
            };

            // Handle closing the lightbox
            const closeLightbox = () => {
                setLightboxOpen(false);
                
                // Remove parameters from URL
                const url = new URL(window.location);
                url.searchParams.delete('gallery');
                url.searchParams.delete('image');
                window.history.pushState({}, '', url);
            };

            // Handle next/previous image
            const nextImage = () => {
                const newIndex = (currentImageIndex + 1) % galleryImages.length;
                setCurrentImageIndex(newIndex);
                
                // Update URL parameter
                const url = new URL(window.location);
                url.searchParams.set('image', newIndex);
                window.history.pushState({}, '', url);
            };

            const prevImage = () => {
                const newIndex = currentImageIndex === 0 ? galleryImages.length - 1 : currentImageIndex - 1;
                setCurrentImageIndex(newIndex);
                
                // Update URL parameter
                const url = new URL(window.location);
                url.searchParams.set('image', newIndex);
                window.history.pushState({}, '', url);
            };

            // Featured images (first 3)
            const featuredImages = galleryImages.slice(0, 3);

            return (
                <div className="max-w-6xl mx-auto px-4 py-8">
                    {/* Featured Gallery Section */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">
                        {featuredImages.map((image, index) => (
                            <FeaturedGalleryItem 
                                key={image.id} 
                                image={image} 
                                index={index}
                                onImageClick={openLightbox}
                            />
                        ))}
                    </div>

                    {/* See More Photos Link */}
                    <div className="text-center mb-16">
                        <a 
                            href="#" 
                            onClick={(e) => {
                                e.preventDefault();
                                openLightbox(0);
                                gtag('event', 'click', {
                                    event_category: 'engagement',
                                    event_label: 'see_more_photos_link'
                                });
                            }}
                            className="elegant-link text-lg"
                            aria-label="View more photos in gallery"
                        >
                            See more photos
                        </a>
                    </div>

                    {/* Simple Shelf Section with Image */}
                    <div className="mb-12">
                        <div className="bg-white rounded-lg overflow-hidden shadow-md">
                            <div className="md:flex">
                                <div className="md:w-1/2">
                                    <img 
                                        src="images/shelving/shelf (03).jpg" 
                                        alt="Simple modular shelf configuration" 
                                        className="w-full h-auto object-cover"
                                    />
                                </div>
                                <div className="p-6 md:w-1/2 flex flex-col justify-center bg-gray-50 md:bg-white">
                                    <h2 className="text-2xl section-title mb-4">Looking for a Simple Shelf?</h2>
                                    <div className="bg-white p-4 rounded-lg shadow-sm md:shadow-none">
                                        <p className="text-gray-700 mb-6">If you want a great shelf without needing to overthink it, our simplified ordering tool will help you get exactly what you need.</p>
                                        <div>
                                            <a 
                                                href="simplified-designer.html" 
                                                className="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-md transition-colors duration-200 inline-block"
                                                onClick={() => {
                                                    gtag('event', 'click', {
                                                        event_category: 'navigation',
                                                        event_label: 'simple_shelf_designer'
                                                    });
                                                }}
                                            >
                                                Start Here
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Custom Shelf Section with GIF */}
                    <div className="mb-16">
                        <div className="bg-white rounded-lg overflow-hidden shadow-md">
                            <div className="md:flex">
                                <div className="md:w-1/2 bg-gray-50">
                                    <img 
                                        src="images/shelving/designer-tutorial.gif" 
                                        alt="Custom shelving design tool" 
                                        className="w-full h-64 md:h-full object-cover object-center"
                                    />
                                </div>
                                <div className="p-6 md:w-1/2 flex flex-col justify-center">
                                    <h2 className="text-2xl section-title mb-4">Looking for a Unique Shelf?</h2>
                                    <p className="text-gray-600 mb-6">If you want to leverage the full potential of our shelving system, we can chat on WhatsApp to find a perfect setup for your space, or you can try out our full shelf designer app.</p>
                                    
                                    <div className="space-y-4">
                                        <div className="bg-gray-50 p-4 rounded-lg">
                                            <h3 className="font-bold text-lg mb-2">Want guidance on a perfect design?</h3>
                                            <a 
                                                href="https://wa.me/254783891005" 
                                                target="_blank"
                                                rel="noopener noreferrer"
                                                className="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-6 rounded-md transition-colors duration-200 inline-block"
                                                onClick={() => {
                                                    gtag('event', 'click', {
                                                        event_category: 'navigation',
                                                        event_label: 'whatsapp_guidance'
                                                    });
                                                }}
                                            >
                                                Contact Us on WhatsApp
                                            </a>
                                        </div>
                                        
                                        <div className="bg-gray-50 p-4 rounded-lg">
                                            <h3 className="font-bold text-lg mb-2">Interested in customizing your own?</h3>
                                            <a 
                                                href="/designer" 
                                                className="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-md transition-colors duration-200 inline-block"
                                                onClick={() => {
                                                    gtag('event', 'click', {
                                                        event_category: 'navigation',
                                                        event_label: 'full_designer'
                                                    });
                                                }}
                                            >
                                                Go to Advanced Designer
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Lightbox Component */}
                    <Lightbox 
                        isOpen={lightboxOpen}
                        currentIndex={currentImageIndex}
                        images={galleryImages}
                        onClose={closeLightbox}
                        onNext={nextImage}
                        onPrev={prevImage}
                    />

                    <WhatsAppButton />
                </div>
            );
        }

        // Render the app
        ReactDOM.render(React.createElement(App), document.getElementById('root'));
    </script>
</body>

</html>