<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-HXHT6KGZT3"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-HXHT6KGZT3', {
            debug_mode: true,
            send_page_view: true,
            allow_google_signals: true,
            enhanced_measurement: {
                scroll: true,        // Enable scroll tracking
                engagement: true,    // Enable engagement time tracking
                page_changes: true,
                url_changes: true
            }
        });
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modular Shelving - Framework Designs</title>
    <link rel="stylesheet" href="css/styles.css">

    <!-- Load React -->
    <script src="https://unpkg.com/react@16/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js"></script>
    <!-- Load Babel -->
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <!-- Load Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .gallery-item {
            transition: transform 0.2s;
        }

        .gallery-item:hover {
            transform: translateY(-4px);
        }

        .new-item {
            animation: fadeInUp 0.3s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .product-svg {
            width: 80px;
            height: 80px;
        }

        .lightbox-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
    </style>
</head>

<body class="bg-white">
    <div class="gallery-container" role="main">
        <p class="gallery-intro">
            Kenya's first modular shelf system. Infinitely expandable with no tools necessary. Start small and add more
            shelves as you need them.<br>
            Scroll down to learn more or <a href="#"
                onclick="document.getElementById('product-list').scrollIntoView({behavior: 'smooth'}); return false;"
                class="hover:text-blue-800">click here to order</a>.
        </p>
    </div>
    <div id="root"></div>

    <script type="text/babel">
        // Product Database
        const products = [
            {
                id: 'standard-base',
                name: 'Standard Base',
                svgPath: 'images/designer/modules/standard-base-NE.svg',
                dimensions: '430mm tall, 980mm wide, 280mm deep',
                price: 6500,
                relatedGalleryIds: ['shelf-01', 'shelf-03']
            },
            {
                id: 'standard-extension',
                name: 'Standard Extension',
                svgPath: 'images/designer/modules/standard-extension-NE.svg',
                dimensions: '300mm tall, 980mm wide, 280mm deep',
                price: 5500,
                relatedGalleryIds: []
            },
            {
                id: 'corner-base',
                name: 'Corner Base',
                svgPath: 'images/designer/modules/corner-base-NE.svg',
                dimensions: '430mm tall, 1220mm wide, 280mm deep',
                price: 7000,
                relatedGalleryIds: []
            },
            {
                id: 'corner-extension',
                name: 'Corner Extension',
                svgPath: 'images/designer/modules/corner-extension-NE.svg',
                dimensions: '300mm tall, 1220mm wide, 280mm deep',
                price: 6000,
                relatedGalleryIds: []
            },
            {
                id: 'wide-base',
                name: 'Wide Base',
                svgPath: 'images/designer/modules/wide-base-NE.svg',
                dimensions: '430mm tall, 1420mm wide, 280mm deep',
                price: 7500,
                relatedGalleryIds: []
            },
            {
                id: 'wide-extension',
                name: 'Wide Extension',
                svgPath: 'images/designer/modules/wide-extension-NE.svg',
                dimensions: '300mm tall, 1420mm wide, 280mm deep',
                price: 6500,
                relatedGalleryIds: []
            },
            {
                id: 'adapter-unit',
                name: 'Adapter Unit',
                svgPath: 'images/designer/modules/adapter-unit-NE.svg',
                dimensions: '300mm tall, 1420mm wide, 280mm deep',
                price: 7000,
                relatedGalleryIds: []
            }
        ];

        function trackScrollDepth() {
            let maxScroll = 0;
            let ticking = false;

            document.addEventListener('scroll', () => {
                if (!ticking) {
                    window.requestAnimationFrame(() => {
                        const scrollPercent = Math.round(
                            (window.scrollY + window.innerHeight) /
                            document.documentElement.scrollHeight * 100
                        );

                        if (scrollPercent > maxScroll) {
                            maxScroll = scrollPercent;
                            gtag('event', 'scroll_depth', {
                                percent_scrolled: maxScroll
                            });
                        }
                        ticking = false;
                    });
                    ticking = true;
                }
            });
        }
        // Original parameter sets definition
        const originalParameterSets = {
            SET_1: {
                original: { fill: '#BBBBBB', fillOpacity: '1', stroke: 'Black', strokeWidth: '0' },
                description: 'Light gray fill'
            },
            SET_2: {
                original: { fill: '#CCCCCC', fillOpacity: '1', stroke: 'Black', strokeWidth: '0' },
                description: 'Medium light gray fill'
            },
            SET_3: {
                original: { fill: '#EEEEEE', fillOpacity: '1', stroke: 'Black', strokeWidth: '0' },
                description: 'Lightest gray fill'
            },
            SET_4: {
                original: { fill: '#555555', fillOpacity: '1', stroke: 'Black', strokeWidth: '0' },
                description: 'Dark gray fill'
            },
            SET_5: {
                original: { fill: '#777777', fillOpacity: '1', stroke: 'Black', strokeWidth: '0' },
                description: 'Darker gray fill'
            },
            SET_6: {
                original: { fill: 'none', fillOpacity: '1', stroke: '#000000', strokeWidth: '0.24' },
                description: 'Border Lines'
            },
            SET_7: {
                original: { fill: 'none', fillOpacity: '1', stroke: '#111111', strokeWidth: '0.24' },
                description: 'All Lines'
            }
        };
        const galleryImages = [
            {
                id: 'shelf-00',
                path: 'images/shelving/shelf (00).jpg',
                caption: 'Our shelves are available in green, black and blue',
                orderConfig: {
                    enabled: false,
                    items: [
                    ]
                }
            },
            {
                id: 'shelf-01',
                path: 'images/shelving/shelf (01).jpg',
                caption: 'The Standard Base comes with two tiers and is fully functional on its own.',
                orderConfig: {
                    enabled: true,
                    items: [
                        { productId: 'standard-base', quantity: 1 }
                    ]
                }
            },
            {
                id: 'shelf-03',
                path: 'images/shelving/shelf (03).jpg',
                caption: 'Standard Base + two Standard Extensions grows into a multi-functional shelving system.',
                orderConfig: {
                    enabled: true,
                    items: [
                        { productId: 'standard-base', quantity: 1 },
                        { productId: 'standard-extension', quantity: 2 }
                    ]
                }
            },
            {
                id: 'shelf-04',
                path: 'images/shelving/shelf (04).jpg',
                caption: 'Standard Base + four Standard Extensions shows how much room there is to grow.',
                orderConfig: {
                    enabled: true,
                    items: [
                        { productId: 'standard-base', quantity: 1 },
                        { productId: 'standard-extension', quantity: 4 }
                    ]
                }
            },
            {
                id: 'shelf-10',
                path: 'images/shelving/shelf (10).jpg',
                caption: 'Adding on extra shelves is as easy as sliding them together. No tools necessary.',
                orderConfig: {
                    enabled: false,
                    items: [
                    ]
                }
            },
            {
                id: 'shelf-11',
                path: 'images/shelving/shelf (11).jpg',
                caption: 'Steel construction makes for a rock-solid structure',
                orderConfig: {
                    enabled: false,
                    items: [
                    ]
                }
            },
            {
                id: 'shelf-11b',
                path: 'images/shelving/shelf (11b).jpg',
                caption: 'Grow your shelves as you grow your library.',
                orderConfig: {
                    enabled: true,
                    items: [
                        { productId: 'standard-base', quantity: 1 },
                        { productId: 'standard-extension', quantity: 1 }
                    ]
                }
            },
            {
                id: 'shelf-12',
                path: 'images/shelving/shelf (12).jpg',
                caption: 'All shelves come with adjustable feet to ensure stability on uneven floors.',
                orderConfig: {
                    enabled: false,
                    items: [
                    ]
                }
            },
            {
                id: 'shelf-13',
                path: 'images/shelving/shelf (13).jpg',
                caption: 'The top unit comes with removable caps, so you get a clean finish that doesn\'t limit you from adding extensions later on.',
                orderConfig: {
                    enabled: false,
                    items: [
                    ]
                }
            },
            {
                id: 'shelf-14',
                path: 'images/shelving/shelf (14).jpg',
                caption: 'Top-knotch fabrication and perfectly engineered details.',
                orderConfig: {
                    enabled: true,
                    items: [
                        { productId: 'standard-base', quantity: 1 },
                        { productId: 'standard-extension', quantity: 1 }
                    ]
                }
            },
            {
                id: 'shelf-17',
                path: 'images/shelving/shelf (17).jpg',
                caption: 'Designed to fit in any corner of your home or office.',
                orderConfig: {
                    enabled: true,
                    items: [
                        { productId: 'standard-base', quantity: 1 },
                        { productId: 'standard-extension', quantity: 1 }
                    ]
                }
            },
            {
                id: 'shelf-18',
                path: 'images/shelving/shelf (18).jpg',
                caption: 'Arrange shelves of different heights of a dynamic effect.',
                orderConfig: {
                    enabled: true,
                    items: [
                        { productId: 'standard-base', quantity: 3 },
                        { productId: 'standard-extension', quantity: 5 }
                    ]
                }
            },
            {
                id: 'shelf-20',
                path: 'images/shelving/shelf (20).jpg',
                caption: 'The system can expand to hold your entire collection.',
                orderConfig: {
                    enabled: true,
                    items: [
                        { productId: 'standard-base', quantity: 2 },
                        { productId: 'standard-extension', quantity: 12 }
                    ]
                }
            },
            {
                id: 'shelf-video',
                path: 'images/shelving/designer-tutorial.gif',  // Change to your GIF path
                loading: "lazy",
                caption: 'Design a shelf that is perfect for your space with our online design tool (best if used on a computer).',
                orderConfig: {
                    enabled: false,
                    items: []
                },
                isVideo: true,
                customButton: {
                    text: 'Design your shelf',
                    color: 'bg-blue-600',
                    href: 'designer.html'
                }
            }
        ];

        // Color themes
        const colorThemes = {
            THEME_1: {
                displayName: 'Blue',
                parameterMappings: {
                    SET_1: { fill: '#ACD1E7', fillOpacity: '1', stroke: 'none', strokeWidth: '0' },
                    SET_2: { fill: '#94BDD5', fillOpacity: '1', stroke: 'none', strokeWidth: '0' },
                    SET_3: { fill: '#C7E2F2', fillOpacity: '1', stroke: 'none', strokeWidth: '0' },
                    SET_4: { fill: '#285596', fillOpacity: '1', stroke: 'none', strokeWidth: '0' },
                    SET_5: { fill: '#2A528D', fillOpacity: '1', stroke: 'none', strokeWidth: '0' },
                    SET_6: { fill: 'none', fillOpacity: '0', stroke: 'White', strokeWidth: '.2' },
                    SET_7: { fill: 'none', fillOpacity: '0', stroke: 'White', strokeWidth: '0' }
                }
            },
            THEME_2: {
                displayName: 'Green',
                parameterMappings: {
                    SET_1: { fill: '#E0F0D2', fillOpacity: '1', stroke: 'none', strokeWidth: '0' },
                    SET_2: { fill: '#A8BFA2', fillOpacity: '1', stroke: 'none', strokeWidth: '0' },
                    SET_3: { fill: '#DAE4D6', fillOpacity: '1', stroke: 'none', strokeWidth: '0' },
                    SET_4: { fill: '#445E3D', fillOpacity: '1', stroke: 'none', strokeWidth: '0' },
                    SET_5: { fill: '#374E32', fillOpacity: '1', stroke: 'none', strokeWidth: '0' },
                    SET_6: { fill: 'none', fillOpacity: '0', stroke: 'White', strokeWidth: '.2' },
                    SET_7: { fill: 'none', fillOpacity: '0', stroke: 'White', strokeWidth: '0' }
                }
            },
            THEME_3: {
                displayName: 'Black',
                parameterMappings: {
                    SET_1: { fill: '#E5E7EB', fillOpacity: '1', stroke: 'none', strokeWidth: '0' },
                    SET_2: { fill: '#D1D5DB', fillOpacity: '1', stroke: 'none', strokeWidth: '0' },
                    SET_3: { fill: '#9CA3AF', fillOpacity: '1', stroke: 'none', strokeWidth: '0' },
                    SET_4: { fill: '#4B5563', fillOpacity: '1', stroke: 'none', strokeWidth: '0' },
                    SET_5: { fill: '#374151', fillOpacity: '1', stroke: 'none', strokeWidth: '0' },
                    SET_6: { fill: 'none', fillOpacity: '0', stroke: 'White', strokeWidth: '.2' },
                    SET_7: { fill: 'none', fillOpacity: '0', stroke: 'White', strokeWidth: '0' }
                }
            }
        };


        const CartTracker = {
            cartStartTime: null,
            maxCartValue: 0,
            initialCartValue: 0,

            trackCartUpdate(items, currentValue, action) {
                if (currentValue > 0 && !this.cartStartTime) {
                    this.cartStartTime = Date.now();
                    this.initialCartValue = currentValue;
                    this.maxCartValue = currentValue;

                    gtag('event', 'cart_started', {
                        value: currentValue,
                        currency: 'KES',
                        items: this.formatItems(items)
                    });
                }

                if (currentValue > this.maxCartValue) {
                    this.maxCartValue = currentValue;
                }

                if (action) {
                    gtag('event', action, {
                        currency: 'KES',
                        value: currentValue,
                        time_in_cart_ms: Date.now() - this.cartStartTime,
                        items: this.formatItems(items)
                    });
                }

                if (currentValue === 0 && this.cartStartTime) {
                    gtag('event', 'cart_abandoned', {
                        time_in_cart_ms: Date.now() - this.cartStartTime,
                        initial_value: this.initialCartValue,
                        max_value: this.maxCartValue,
                        currency: 'KES'
                    });

                    this.cartStartTime = null;
                    this.maxCartValue = 0;
                    this.initialCartValue = 0;
                }
            },

            trackCheckoutStart(items, value) {
                gtag('event', 'begin_checkout', {
                    currency: 'KES',
                    value: value,
                    time_in_cart_ms: this.cartStartTime ? Date.now() - this.cartStartTime : 0,
                    items: this.formatItems(items)
                });
            },

            formatItems(items) {
                return Object.entries(items).map(([id, quantity]) => {
                    const product = products.find(p => p.id === id);
                    return {
                        item_id: id,
                        item_name: product ? product.name : '',
                        quantity: quantity,
                        price: product ? product.price : 0
                    };
                });
            }
        };

        // Components
        function GalleryImage(props) {
            const image = props.image;
            const hasOrderConfig = image.orderConfig && image.orderConfig.enabled;
            const hasCustomButton = image.customButton;

            const actionButton = hasOrderConfig ? (
                <button
                    onClick={() => props.onConfigurationSelect(image.orderConfig, image)}
                    className="absolute bottom-3 right-3 bg-white/90 text-gray-800 px-3 py-1.5 
                rounded-md text-sm shadow-sm border border-gray-100
                transition-all duration-200 hover:bg-white hover:shadow-md"
                >
                    Order this design
                </button>
            ) : hasCustomButton ? (
                <a
                    href={image.customButton.href}
                    className={`absolute bottom-3 right-3 ${image.customButton.color} text-white px-3 py-1.5 
            rounded-md text-sm shadow-sm 
            transition-all duration-200 hover:opacity-90 hover:shadow-md`}
                >
                    {image.customButton.text}
                </a>
            ) : null;

            return (
                <div className="relative">
                    <div className="relative aspect-square">
                        {image.isVideo ? (
                            <img
                                src={image.path}
                                alt={image.caption}
                                loading={props.index > 2 ? "lazy" : "eager"}
                                className="w-full h-full object-cover rounded-lg"
                            />
                        ) : (
                            <img
                                src={image.path}
                                alt={image.caption}
                                loading={props.index > 2 ? "lazy" : "eager"}
                                className="w-full h-full object-cover rounded-lg"
                            />
                        )}
                        {actionButton}
                    </div>
                    <p className="mt-3 text-sm text-gray-600">{image.caption}</p>
                </div>
            );
        }
        function Gallery(props) {
            return (
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12">
                    {galleryImages.map((image, index) => (
                        <GalleryImage
                            key={image.id}
                            image={image}
                            index={index}
                            onConfigurationSelect={props.onConfigurationSelect}
                        />
                    ))}
                </div>
            );
        }


        function WhatsAppButton(props) {
            if (props.isCartVisible) return null;

            return (
                <a
                    href="https://wa.me/254783891005"
                    target="_blank"
                    rel="noopener noreferrer"
                    className="fixed bottom-6 right-6 bg-green-600 text-white p-4 rounded-full shadow-lg hover:bg-green-700 transition-all duration-200 z-50 flex items-center gap-2 group md:pr-6"
                    onClick={() => {
                        gtag('event', 'click_chat', {
                            event_category: 'engagement',
                            event_label: 'whatsapp_chat'
                        });
                    }}
                >
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z" />
                    </svg>
                    <span className="hidden md:inline whitespace-nowrap">Chat on WhatsApp</span>
                </a>
            );
        }
        function ProductImage(props) {
            const [svgContent, setSvgContent] = React.useState('');

            // Create a mapping from the original colors to theme colors
            const getColorMapping = (theme) => ({
                '#BBBBBB': theme.parameterMappings.SET_1.fill,  // Light gray
                '#CCCCCC': theme.parameterMappings.SET_2.fill,  // Medium light gray
                '#EEEEEE': theme.parameterMappings.SET_3.fill,  // Lightest gray
                '#555555': theme.parameterMappings.SET_4.fill,  // Dark gray
                '#777777': theme.parameterMappings.SET_5.fill   // Darker gray
            });

            React.useEffect(() => {
                fetch(props.svgPath)
                    .then(res => res.text())
                    .then(svg => {
                        const theme = colorThemes[props.selectedColor];
                        if (!theme || !theme.parameterMappings) {
                            console.error('Theme not found:', props.selectedColor);
                            return;
                        }

                        let modifiedSvg = svg;
                        const colorMapping = getColorMapping(theme);

                        // Replace fill colors
                        Object.entries(colorMapping).forEach(([originalColor, newColor]) => {
                            const regex = new RegExp(`fill="${originalColor}"`, 'g');
                            modifiedSvg = modifiedSvg.replace(regex, `fill="${newColor}"`);
                        });

                        // Handle line attributes (SET_6 and SET_7)
                        // First, handle visible strokes
                        modifiedSvg = modifiedSvg.replace(
                            /stroke="Black"\s+stroke-width="0\.24"/g,
                            `stroke="${theme.parameterMappings.SET_6.stroke}" stroke-width="${theme.parameterMappings.SET_6.strokeWidth}"`
                        );

                        // Then handle the non-visible strokes
                        modifiedSvg = modifiedSvg.replace(
                            /stroke="Black"\s+stroke-width="0"/g,
                            `stroke="${theme.parameterMappings.SET_7.stroke}" stroke-width="${theme.parameterMappings.SET_7.strokeWidth}"`
                        );

                        // Additional handling for specific stroke cases
                        modifiedSvg = modifiedSvg.replace(
                            /stroke="#000000"/g,
                            `stroke="${theme.parameterMappings.SET_6.stroke}"`
                        );
                        modifiedSvg = modifiedSvg.replace(
                            /stroke="#111111"/g,
                            `stroke="${theme.parameterMappings.SET_7.stroke}"`
                        );


                        setSvgContent(modifiedSvg);
                    })
                    .catch(error => {
                        console.error('Error loading or processing SVG:', error);
                    });
            }, [props.svgPath, props.selectedColor]);

            return (
                <div
                    className="w-24 h-24 cursor-pointer bg-gray-50 rounded flex items-center justify-center"
                    onClick={props.onClick}
                    dangerouslySetInnerHTML={{ __html: svgContent }}
                />
            );
        }

        function ImageLightbox(props) {
            const [currentIndex, setCurrentIndex] = React.useState(0);

            if (!props.isOpen) return null;

            function handleNext() {
                setCurrentIndex(function (current) {
                    return (current + 1) % props.images.length;
                });
            }

            function handlePrev() {
                setCurrentIndex(function (current) {
                    return current === 0 ? props.images.length - 1 : current - 1;
                });
            }

            return (
                <div className="lightbox-overlay" onClick={props.onClose}>
                    <div className="bg-white rounded-lg max-w-3xl w-full m-4" onClick={function (e) { e.stopPropagation(); }}>
                        <div className="relative">
                            <img
                                src={props.images[currentIndex].path}
                                alt={props.images[currentIndex].caption}
                                className="w-full h-auto rounded-t-lg"
                            />
                            <button
                                onClick={props.onClose}
                                className="absolute top-4 right-4 p-2 bg-white/80 rounded-full hover:bg-white"
                            >
                                ×
                            </button>
                            {props.images.length > 1 && (
                                <div className="absolute inset-y-0 left-0 right-0 flex justify-between items-center px-4">
                                    <button onClick={handlePrev} className="bg-white/80 rounded-full p-2">←</button>
                                    <button onClick={handleNext} className="bg-white/80 rounded-full p-2">→</button>
                                </div>
                            )}
                        </div>
                        <div className="p-4">
                            <p className="text-sm text-gray-600">
                                {props.images[currentIndex].caption}
                            </p>
                        </div>
                    </div>
                </div>
            );
        }

        function ProductList(props) {
            const [lightboxOpen, setLightboxOpen] = React.useState(false);
            const [selectedProduct, setSelectedProduct] = React.useState(null);

            function handleImageClick(product) {
                const relatedImages = product.relatedGalleryIds
                    .map(function (id) {
                        return galleryImages.find(function (img) { return img.id === id; });
                    })
                    .filter(Boolean);

                if (relatedImages.length > 0) {
                    setSelectedProduct(product);
                    setLightboxOpen(true);
                }
            }

            return (
                <div className="space-y-4">
                    {props.products.map(function (product) {
                        return (
                            <div key={product.id}
                                className="flex items-center gap-4 p-4 bg-white border rounded-lg shadow-sm hover:shadow-md transition-shadow">
                                <ProductImage
                                    svgPath={product.svgPath}
                                    selectedColor={props.selectedColor}
                                    onClick={function () { handleImageClick(product); }}
                                />
                                <div className="flex-1">
                                    <h3 className="font-medium">{product.name}</h3>
                                    <p className="text-sm text-gray-600">{product.dimensions}</p>
                                    <p className="mt-1">Ksh {product.price.toLocaleString()}</p>
                                </div>
                                <div className="flex items-center gap-2">
                                    <button
                                        onClick={function () { props.onUpdateQuantity(product.id, (props.items[product.id] || 0) - 1); }}
                                        className="p-1 text-blue-600 hover:bg-blue-50 rounded-full"
                                    >
                                        -
                                    </button>
                                    <span className="w-8 text-center">
                                        {props.items[product.id] || 0}
                                    </span>
                                    <button
                                        onClick={function () { props.onUpdateQuantity(product.id, (props.items[product.id] || 0) + 1); }}
                                        className="p-1 text-blue-600 hover:bg-blue-50 rounded-full"
                                    >
                                        +
                                    </button>
                                </div>
                            </div>
                        );
                    })}

                    {lightboxOpen && selectedProduct && (
                        <ImageLightbox
                            images={selectedProduct.relatedGalleryIds
                                .map(function (id) {
                                    return galleryImages.find(function (img) { return img.id === id; });
                                })
                                .filter(Boolean)}
                            isOpen={lightboxOpen}
                            onClose={function () { setLightboxOpen(false); }}
                        />
                    )}
                </div>
            );
        }

        // Update the Cart component
        function Cart() {
            const [selectedColor, setSelectedColor] = React.useState('THEME_1');
            const [items, setItems] = React.useState({});
            const productListRef = React.useRef(null);

            // Initialize scroll tracking
            React.useEffect(() => {
                trackScrollDepth();
            }, []);

            // Calculate current cart value
            const calculateTotal = (items) => {
                return Object.keys(items).reduce((sum, productId) => {
                    const product = products.find(p => p.id === productId);
                    return sum + (product ? product.price * items[productId] : 0);
                }, 0);
            };

            // Simplified onUpdateQuantity function
            function onUpdateQuantity(productId, newQuantity) {
                setItems(prev => {
                    const newItems = { ...prev };

                    if (newQuantity <= 0) {
                        delete newItems[productId];
                    } else {
                        newItems[productId] = newQuantity;
                    }

                    CartTracker.trackCartUpdate(
                        newItems,
                        calculateTotal(newItems),
                        newQuantity > (prev[productId] || 0) ? 'add_to_cart' : 'remove_from_cart'
                    );

                    return newItems;
                });
            }

            // Updated generateWhatsAppMessage function
            function generateWhatsAppMessage() {
                const currentValue = calculateTotal(items);
                const lines = Object.keys(items)
                    .filter(productId => items[productId] > 0)
                    .map(productId => {
                        const product = products.find(p => p.id === productId);
                        return `${items[productId]} x ${product.name} @ Ksh ${product.price.toLocaleString()}`;
                    });

                CartTracker.trackCheckoutStart(items, currentValue);

                return encodeURIComponent(
                    'I\'d like to place an order for:\n' + lines.join('\n') + '\n' +
                    'All in ' + colorThemes[selectedColor].displayName + '\n' +
                    'Total Cost: Ksh ' + currentValue.toLocaleString() + ' (VAT inclusive)'
                );
            }

            const total = calculateTotal(items);
            const hasItems = total > 0;

            function setConfiguration(config) {
                if (!config || !config.items) return;

                const newItems = {};
                config.items.forEach(item => {
                    newItems[item.productId] = item.quantity;
                });

                setItems(newItems);

                // Add scroll to product list
                if (productListRef.current) {
                    productListRef.current.scrollIntoView({ behavior: 'smooth' });
                }
            }

            return (
                <div className="max-w-6xl mx-auto px-4 py-8">
                    <Gallery onConfigurationSelect={setConfiguration} />

                    <div className="mb-8" ref={productListRef} id="product-list">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                            Select Color:
                        </label>
                        <select
                            value={selectedColor}
                            onChange={(e) => {
                                setSelectedColor(e.target.value);
                                gtag('event', 'select_color', {
                                    color_name: colorThemes[e.target.value].displayName
                                });
                            }}
                            className="border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        >
                            {Object.keys(colorThemes).map((key) => (
                                <option key={key} value={key}>
                                    {colorThemes[key].displayName}
                                </option>
                            ))}
                        </select>
                    </div>

                    <div className="pb-24">
                        <ProductList
                            products={products}
                            items={items}
                            onUpdateQuantity={onUpdateQuantity}
                            selectedColor={selectedColor}
                        />
                    </div>

                    {total > 0 && (
                        <div className="fixed bottom-0 left-0 right-0 bg-white border-t shadow-lg p-4">
                            <div className="max-w-6xl mx-auto flex items-center justify-between">
                                <div className="flex items-center">
                                    <span className="text-lg font-medium whitespace-nowrap">
                                        Total: Ksh {total.toLocaleString()}
                                    </span>
                                    <span className="text-sm text-gray-500 ml-2 hidden sm:inline">
                                        (VAT inclusive)
                                    </span>
                                </div>
                                <a
                                    href={`https://wa.me/254783891005?text=${generateWhatsAppMessage()}`}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    className="bg-green-600 text-white px-6 py-2.5 rounded-lg hover:bg-green-700 transition-colors whitespace-nowrap"
                                >
                                    Order via WhatsApp
                                </a>
                            </div>
                        </div>
                    )}
                    <WhatsAppButton isCartVisible={hasItems} />
                </div>
            );
        }

        // Render the app
        ReactDOM.render(React.createElement(Cart), document.getElementById('root'));
    </script>


    <script src="js/site.js"></script>
</body>

</html>